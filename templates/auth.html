<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shiv Shambhu Hotel - Login</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <main class="auth-page">
        <section class="auth-card">
            <div class="auth-brand">
                <div class="logo-circle">üïâÔ∏è</div>
                <div>
                    <h1>Shiv Shambhu</h1>
                    <p class="muted">Welcome ‚Äî please sign in or create an account</p>
                </div>
            </div>

            <div class="auth-tabs" role="tablist" aria-label="Authentication Tabs">
                <button id="tab-login" class="tab active" aria-controls="panel-login">Login</button>
                <button id="tab-signup" class="tab" aria-controls="panel-signup">Sign up</button>
                <button class="tab" onclick="window.location.href='/admin-login'">Admin Login</button>
            </div>

            <div id="panel-login" class="auth-panel" role="tabpanel">
                <form action="/login" method="post" class="form" novalidate>
                    <label for="login-username">Username</label>
                    <input id="login-username" type="text" name="username" placeholder="e.g. john_doe" required>

                    <label for="login-password">Password</label>
                    <div class="password-row">
                        <input id="login-password" type="password" name="password" placeholder="Your password" required>
                        <button type="button" class="show-pass" data-target="login-password">Show</button>
                    </div>

                    <button type="submit" class="btn primary">Sign in</button>
                    <div class="form-actions">
                        <button type="button" class="btn ghost" id="guest-btn">Guest login</button>
                    </div>
                </form>
            </div>

            <div id="panel-signup" class="auth-panel" role="tabpanel" hidden>
                <form action="/signup" method="post" class="form" novalidate>
                    <label for="signup-username">Choose a username</label>
                    <input id="signup-username" type="text" name="username" placeholder="username" required>

                    <label for="signup-password">Create password</label>
                    <div class="password-row">
                        <input id="signup-password" type="password" name="password" placeholder="At least 6 characters" required>
                        <button type="button" class="show-pass" data-target="signup-password">Show</button>
                    </div>

                    <button type="submit" class="btn primary">Create account</button>
                </form>
            </div>
        </section>
    </main>

    <div id="guest-modal" class="success-modal" aria-hidden="true">
        <div class="success-modal-content" role="dialog" aria-modal="true" aria-labelledby="guest-title">
            <button type="button" class="success-close" id="guest-close" aria-label="Close">√ó</button>
            <h3 id="guest-title">Continue as Guest</h3>
            <p class="success-subtext">Enter your name to start ordering.</p>
            <form id="guest-form" class="form" novalidate>
                <label for="guest-name">Guest Name</label>
                <input id="guest-name" type="text" name="guest_name" placeholder="e.g. Alex" required>
                <button id="guest-done" type="submit" class="btn primary">Done</button>
            </form>
        </div>
    </div>

    <script>
        // Tab switching
        (function(){
            const tabLogin = document.getElementById('tab-login');
            const tabSignup = document.getElementById('tab-signup');
            const panelLogin = document.getElementById('panel-login');
            const panelSignup = document.getElementById('panel-signup');

            function activate(tab){
                if(tab === 'login'){
                    tabLogin.classList.add('active'); tabSignup.classList.remove('active');
                    panelLogin.hidden = false; panelSignup.hidden = true;
                } else {
                    tabLogin.classList.remove('active'); tabSignup.classList.add('active');
                    panelLogin.hidden = true; panelSignup.hidden = false;
                }
            }
            tabLogin.addEventListener('click', ()=>activate('login'));
            tabSignup.addEventListener('click', ()=>activate('signup'));

            // show/hide password
            document.querySelectorAll('.show-pass').forEach(btn => {
                btn.addEventListener('click', function(){
                    const id = this.getAttribute('data-target');
                    const input = document.getElementById(id);
                    if(!input) return;
                    if(input.type === 'password') { input.type = 'text'; this.textContent = 'Hide'; }
                    else { input.type = 'password'; this.textContent = 'Show'; }
                });
            });
            // Guest login flow: modal for name then POST to /guest
            const guestBtn = document.getElementById('guest-btn');
            const guestModal = document.getElementById('guest-modal');
            const guestInput = document.getElementById('guest-name');
            const guestForm = document.getElementById('guest-form');
            const guestClose = document.getElementById('guest-close');

            function openGuestModal() {
                if (!guestModal) return;
                guestModal.classList.add('active');
                guestModal.setAttribute('aria-hidden', 'false');
                if (guestInput) {
                    guestInput.value = '';
                    guestInput.focus();
                }
            }

            function closeGuestModal() {
                if (!guestModal) return;
                guestModal.classList.remove('active');
                guestModal.setAttribute('aria-hidden', 'true');
            }

            if (guestBtn) {
                guestBtn.addEventListener('click', openGuestModal);
            }

            if (guestClose) {
                guestClose.addEventListener('click', closeGuestModal);
            }

            if (guestModal) {
                guestModal.addEventListener('click', function (e) {
                    if (e.target === guestModal) closeGuestModal();
                });
            }

            if (guestForm) {
                guestForm.addEventListener('submit', function (e) {
                    e.preventDefault();
                    const name = (guestInput && guestInput.value || '').trim();
                    const doneBtn = document.getElementById('guest-done');
                    if (doneBtn) doneBtn.disabled = true;
                    fetch('/guest', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ name: name })
                    })
                        .then(r => r.json())
                        .then(resp => {
                            if (resp && resp.user) {
                                localStorage.setItem('guestName', resp.user);
                            } else {
                                localStorage.setItem('guestName', name);
                            }
                            closeGuestModal();
                            window.location.href = (resp && resp.redirect) ? resp.redirect : '/menu';
                        })
                        .catch(err => {
                            console.error(err);
                            localStorage.setItem('guestName', name);
                            closeGuestModal();
                            window.location.href = '/menu';
                        })
                        .finally(() => {
                            if (doneBtn) doneBtn.disabled = false;
                        });
                });
            }
        })();
    </script>
</body>
</html>
